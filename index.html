<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Planner Terpadu 2026 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        .sidebar-item-active { background-color: #1e293b; border-left: 4px solid #3b82f6; color: white; }
        
        .calendar-day { 
            min-height: 90px; display: flex; flex-direction: column; align-items: flex-start; 
            justify-content: flex-start; cursor: pointer; border-radius: 8px; transition: all 0.2s; 
            position: relative; border: 1px solid #e2e8f0; padding: 4px; background-color: white;
            overflow: hidden;
        }
        @media (min-width: 768px) { .calendar-day { min-height: 120px; padding: 6px; } }
        
        .today-highlight { 
            border: 2.5px solid #0f172a !important; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .day-success { background-color: #f0fdf4 !important; border-color: #22c55e !important; }
        .day-fail { background-color: #fef2f2 !important; border-color: #ef4444 !important; }
        
        .target-pill-1w { background-color: #0ea5e9; }
        .target-pill-1m { background-color: #10b981; }
        .target-pill-3m { background-color: #f59e0b; }
        .target-pill-6m { background-color: #f43f5e; }

        .target-pill, .task-pill, .recurring-pill {
            font-size: 7px; padding: 1px 3px; border-radius: 3px; color: white; margin-top: 2px;
            width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 700;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        @media (min-width: 768px) { .target-pill, .task-pill, .recurring-pill { font-size: 9px; padding: 2px 4px; margin-top: 3px; } }
        
        .task-pill { background-color: #64748b; }
        .recurring-pill { background-color: #8b5cf6; }
        
        .quadrant-card { height: 280px; overflow-y: auto; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        #sidebar { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="text-slate-800 flex h-screen overflow-hidden bg-slate-50">

    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-slate-900/50 z-30 hidden lg:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-slate-900 text-slate-300 flex flex-col shadow-xl z-40 transform -translate-x-full lg:translate-x-0 lg:static lg:inset-auto">
        <div class="p-6 flex items-center justify-between text-white border-b border-slate-800">
            <div class="flex items-center space-x-3">
                <i class="fas fa-chart-line text-blue-500 text-2xl"></i>
                <span class="font-bold tracking-widest text-sm uppercase text-blue-400">Konsistent</span>
            </div>
            <button onclick="toggleSidebar()" class="lg:hidden text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        
        <nav class="flex-grow py-6 space-y-1 overflow-y-auto">
            <button onclick="setView('dashboard')" id="nav-dashboard" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition sidebar-item-active">
                <i class="fas fa-th-large w-5"></i><span>Dashboard</span>
            </button>
            <button onclick="setView('daily')" id="nav-daily" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-list-check w-5"></i><span>Rencana Harian</span>
            </button>
            <button onclick="setView('recurring')" id="nav-recurring" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-redo-alt w-5 text-purple-400"></i><span>Tugas Tetap</span>
            </button>
            <button onclick="setView('target')" id="nav-target" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-bullseye w-5 text-rose-400"></i><span>Target Realistis</span>
            </button>
            <button onclick="setView('list-tugas')" id="nav-list-tugas" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-clipboard-list w-5"></i><span>List Tugas</span>
            </button>
            <button onclick="setView('calendar')" id="nav-calendar" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-calendar-alt w-5"></i><span>Kalender 2026</span>
            </button>
            <button onclick="setView('financial')" id="nav-financial" class="w-full flex items-center space-x-3 px-6 py-3 text-sm transition hover:bg-slate-800">
                <i class="fas fa-wallet w-5 text-emerald-400"></i><span>Keuangan</span>
            </button>
        </nav>
        
        <div class="p-6 bg-slate-800/50 border-t border-slate-800">
            <div class="flex justify-between items-center mb-2">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Total Progres Sistem</p>
                <i class="fas fa-cloud-upload-alt text-blue-500 text-[10px]" title="Semua data otomatis tersimpan"></i>
            </div>
            <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                <div id="overall-progress" class="bg-blue-500 h-full w-0 transition-all duration-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]"></div>
            </div>
            <p id="progress-text" class="text-[8px] text-slate-500 mt-1 uppercase text-right">0%</p>
        </div>
    </aside>

    <div class="flex-grow flex flex-col overflow-hidden w-full">
        <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-4 lg:px-8 shrink-0">
            <div class="flex items-center space-x-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg"><i class="fas fa-bars"></i></button>
                <h2 id="view-title" class="font-bold text-slate-700 uppercase tracking-widest text-xs sm:text-sm text-blue-600 truncate">Dashboard</h2>
            </div>
            <div class="flex items-center space-x-3">
                <span class="text-[9px] font-bold text-emerald-500 bg-emerald-50 px-2 py-1 rounded border border-emerald-100 hidden md:inline-flex items-center">
                    <i class="fas fa-check-circle mr-1"></i> Tersimpan
                </span>
                <div id="current-date-display" class="hidden sm:block text-[10px] sm:text-xs font-mono font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full"></div>
            </div>
        </header>

        <main class="flex-grow overflow-y-auto p-4 lg:p-8 bg-slate-50 scroll-smooth">
            <div id="content-area" class="max-w-7xl mx-auto space-y-6 lg:space-y-8">
                
                <!-- VIEW: DASHBOARD -->
                <div id="view-dashboard" class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Tugas Hari Ini (Total)</p>
                            <h3 id="dash-daily" class="text-xl lg:text-2xl font-bold text-slate-800">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-rose-500">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Target Aktif</p>
                            <h3 id="dash-target" class="text-xl lg:text-2xl font-bold text-slate-800">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-emerald-500">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Probabilitas Konsisten</p>
                            <h3 id="dash-probability" class="text-xl lg:text-2xl font-bold text-emerald-600">0%</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-purple-500">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Tugas Tetap</p>
                            <h3 id="dash-recurring" class="text-xl lg:text-2xl font-bold text-purple-600">0</h3>
                        </div>
                    </div>
                </div>

                <!-- VIEW: RENCANA HARIAN -->
                <div id="view-daily" class="hidden space-y-6">
                    <div class="bg-white p-4 rounded-xl border border-slate-200 flex flex-col md:flex-row gap-3 shadow-sm">
                        <input type="text" id="daily-input" placeholder="Rencana baru hari ini..." class="flex-grow bg-slate-50 border-none px-4 py-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="time" id="daily-time" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500">
                        <select id="daily-quadrant" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm outline-none">
                            <option value="1">1. Penting - Mendesak</option>
                            <option value="2">2. Penting - Tidak Mendesak</option>
                            <option value="3">3. Tidak Penting - Mendesak</option>
                            <option value="4">4. Tidak Penting - Tidak Mendesak</option>
                        </select>
                        <button onclick="addDailyTask()" class="bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-bold w-full md:w-auto hover:bg-blue-700 transition">TAMBAH</button>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="bg-red-50 p-4 rounded-xl border border-red-100 shadow-inner">
                            <h4 class="text-[10px] font-black text-red-600 uppercase mb-3 flex items-center"><i class="fas fa-fire mr-1"></i> Skala 1: Penting & Mendesak</h4>
                            <div id="q-1" class="quadrant-card space-y-2"></div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 shadow-inner">
                            <h4 class="text-[10px] font-black text-blue-600 uppercase mb-3 flex items-center"><i class="fas fa-star mr-1"></i> Skala 2: Penting & Tidak Mendesak</h4>
                            <div id="q-2" class="quadrant-card space-y-2"></div>
                        </div>
                        <div class="bg-amber-50 p-4 rounded-xl border border-amber-100 shadow-inner">
                            <h4 class="text-[10px] font-black text-amber-600 uppercase mb-3 flex items-center"><i class="fas fa-bolt mr-1"></i> Skala 3: Tidak Penting & Mendesak</h4>
                            <div id="q-3" class="quadrant-card space-y-2"></div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-xl border border-slate-200 shadow-inner">
                            <h4 class="text-[10px] font-black text-slate-500 uppercase mb-3 flex items-center"><i class="fas fa-coffee mr-1"></i> Skala 4: Tidak Penting & Tidak Mendesak</h4>
                            <div id="q-4" class="quadrant-card space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: TARGET REALISTIS -->
                <div id="view-target" class="hidden space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-6">
                        <h3 class="text-sm font-black text-slate-700 uppercase tracking-widest"><i class="fas fa-bullseye mr-2 text-rose-500"></i> Perencanaan Target Realistis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Nama Target</label>
                                <input type="text" id="target-input" placeholder="Misal: Mahir NextJS" class="w-full bg-slate-50 border-none px-4 py-2 rounded-lg text-sm focus:ring-2 focus:ring-rose-500">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Mulai Tanggal</label>
                                <input type="date" id="target-start-date" class="w-full bg-slate-50 border-none px-4 py-2 rounded-lg text-sm focus:ring-2 focus:ring-rose-500">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Periode Waktu</label>
                                <select id="target-period" class="w-full bg-slate-50 border-none px-4 py-2 rounded-lg text-sm focus:ring-2 focus:ring-rose-500">
                                    <option value="1w">1 Minggu</option>
                                    <option value="1m">1 Bulan</option>
                                    <option value="3m">3 Bulan</option>
                                    <option value="6m">6 Bulan</option>
                                </select>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Skala Prioritas</label>
                                <select id="target-quadrant" class="w-full bg-slate-50 border-none px-4 py-2 rounded-lg text-sm focus:ring-2 focus:ring-rose-500">
                                    <option value="1">Skala 1 (Kritis)</option>
                                    <option value="2">Skala 2 (Penting)</option>
                                    <option value="3">Skala 3 (Waspada)</option>
                                    <option value="4">Skala 4 (Terjadwal)</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button onclick="addTargetRealistis()" class="w-full bg-rose-600 text-white py-2 rounded-lg text-sm font-bold shadow-lg hover:bg-rose-700 transition">SIMPAN</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-slate-200 pt-2">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-red-50 p-4 rounded-xl border border-red-100 shadow-inner">
                                <h4 class="text-[10px] font-black text-red-600 uppercase mb-3 flex items-center"><i class="fas fa-fire mr-1"></i> Skala 1: Target Kritis</h4>
                                <div id="tgt-q-1" class="space-y-2 min-h-[50px]"></div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 shadow-inner">
                                <h4 class="text-[10px] font-black text-blue-600 uppercase mb-3 flex items-center"><i class="fas fa-star mr-1"></i> Skala 2: Target Penting</h4>
                                <div id="tgt-q-2" class="space-y-2 min-h-[50px]"></div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-xl border border-amber-100 shadow-inner">
                                <h4 class="text-[10px] font-black text-amber-600 uppercase mb-3 flex items-center"><i class="fas fa-bolt mr-1"></i> Skala 3: Target Waspada</h4>
                                <div id="tgt-q-3" class="space-y-2 min-h-[50px]"></div>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-xl border border-slate-200 shadow-inner">
                                <h4 class="text-[10px] font-black text-slate-500 uppercase mb-3 flex items-center"><i class="fas fa-coffee mr-1"></i> Skala 4: Target Jangka Panjang</h4>
                                <div id="tgt-q-4" class="space-y-2 min-h-[50px]"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: TUGAS TETAP -->
                <div id="view-recurring" class="hidden space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-6">
                        <h3 class="text-sm font-black text-slate-700 uppercase tracking-widest"><i class="fas fa-redo-alt mr-2 text-purple-600"></i> Tugas Rutin</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="rec-name" placeholder="Nama tugas tetap..." class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm">
                            <input type="time" id="rec-time" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm">
                            <select id="rec-quadrant" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm">
                                <option value="1">Skala 1</option><option value="2">Skala 2</option><option value="3">Skala 3</option><option value="4">Skala 4</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="1"> <span>Senin</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="2"> <span>Selasa</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="3"> <span>Rabu</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="4"> <span>Kamis</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="5"> <span>Jumat</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="6"> <span>Sabtu</span></label>
                            <label class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-lg text-xs"><input type="checkbox" name="rec-days" value="0"> <span class="text-red-500">Minggu</span></label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                            <select id="rec-period" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm"><option value="3">3 Bulan</option><option value="6">6 Bulan</option><option value="12">1 Tahun</option><option value="999">Selamanya</option></select>
                            <button id="rec-btn-save" onclick="saveRecurringTask()" class="bg-purple-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-purple-700 transition">SIMPAN TUGAS TETAP</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl border border-slate-200 overflow-x-auto shadow-sm">
                        <table class="w-full text-left text-xs">
                            <thead class="bg-slate-900 text-white font-bold uppercase">
                                <tr><th class="p-4">Tugas</th><th class="p-4">Jadwal Hari</th><th class="p-4 text-center">Skala</th><th class="p-4 text-center">Aksi</th></tr>
                            </thead>
                            <tbody id="rec-list-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- VIEW: LIST TUGAS -->
                <div id="view-list-tugas" class="hidden space-y-8">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <input type="text" id="tugas-input" placeholder="Nama tugas..." class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm outline-none">
                            <input type="date" id="tugas-date" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm outline-none">
                            <button onclick="addListTugas()" class="bg-green-600 text-white py-2 rounded-lg text-sm font-bold">TAMBAH</button>
                        </div>
                    </div>
                    <div id="tugas-list-raw" class="space-y-2"></div>
                    <div class="border-t border-slate-200 pt-8">
                        <h3 class="text-xs font-black text-slate-700 uppercase mb-6 tracking-widest"><i class="fas fa-sort-amount-down mr-2 text-blue-600"></i> Prioritas Deadline</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-red-50 p-4 rounded-xl border-2 border-red-200"><h4 class="text-[9px] font-bold text-red-700 mb-2 uppercase">Kritis (&le; 2H)</h4><div id="t-q-1" class="space-y-2"></div></div>
                            <div class="bg-amber-50 p-4 rounded-xl border-2 border-amber-200"><h4 class="text-[9px] font-bold text-amber-700 mb-2 uppercase">Penting (3-7H)</h4><div id="t-q-2" class="space-y-2"></div></div>
                            <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-200"><h4 class="text-[9px] font-bold text-blue-700 mb-2 uppercase">Waspada (8-14H)</h4><div id="t-q-3" class="space-y-2"></div></div>
                            <div class="bg-slate-100 p-4 rounded-xl border-2 border-slate-300"><h4 class="text-[9px] font-bold text-slate-700 mb-2 uppercase">Terjadwal (> 14H)</h4><div id="t-q-4" class="space-y-2"></div></div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: KALENDER -->
                <div id="view-calendar" class="hidden space-y-6">
                    <div class="bg-white p-4 sm:p-8 rounded-2xl border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i class="fas fa-chevron-left text-slate-500"></i></button>
                            <div class="text-center">
                                <h3 id="cal-month" class="font-black text-slate-800 uppercase tracking-tighter text-sm sm:text-lg">Januari 2026</h3>
                            </div>
                            <button onclick="changeMonth(1)" class="p-2 hover:bg-slate-100 rounded-full transition-colors"><i class="fas fa-chevron-right text-slate-500"></i></button>
                        </div>
                        <div class="grid grid-cols-7 gap-1 sm:gap-3 text-center mb-2">
                            <div class="text-[8px] sm:text-[10px] font-black text-red-500 uppercase">Min</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-slate-400 uppercase">Sen</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-slate-400 uppercase">Sel</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-slate-400 uppercase">Rab</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-slate-400 uppercase">Kam</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-slate-400 uppercase">Jum</div>
                            <div class="text-[8px] sm:text-[10px] font-black text-red-500 uppercase">Sab</div>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-1 sm:gap-3"></div>
                    </div>
                </div>

                <!-- VIEW: KEUANGAN -->
                <div id="view-financial" class="hidden space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl border-l-4 border-l-green-500 shadow-sm font-bold">Pemasukan: <span id="fin-income">Rp 0</span></div>
                        <div class="bg-white p-6 rounded-2xl border-l-4 border-l-red-500 shadow-sm font-bold">Pengeluaran: <span id="fin-expense">Rp 0</span></div>
                        <div class="bg-slate-900 p-6 rounded-2xl border-l-4 border-l-blue-500 text-white shadow-sm font-bold">Saldo: <span id="fin-balance">Rp 0</span></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
                            <input type="text" id="fin-title" placeholder="Keterangan..." class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm">
                            <input type="number" id="fin-amount" placeholder="Nominal..." class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm">
                            <select id="fin-category" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm"><option value="Pemasukan">Pemasukan</option><option value="Makan">Makan</option><option value="Transport">Transport</option><option value="Hiburan">Hiburan</option><option value="Lainnya">Lainnya</option></select>
                            <select id="fin-type" class="bg-slate-50 border-none px-4 py-2 rounded-lg text-sm"><option value="income">Masuk (+)</option><option value="expense">Keluar (-)</option></select>
                            <button onclick="addFinancialTransaction()" class="bg-blue-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-blue-700 transition">SIMPAN</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl border border-slate-200 overflow-x-auto shadow-sm">
                        <table class="w-full text-left text-xs">
                            <thead class="bg-slate-900 text-white font-bold uppercase">
                                <tr><th class="p-4">Tanggal</th><th class="p-4">Keterangan</th><th class="p-4 text-right">Nominal</th><th class="p-4 text-center">Aksi</th></tr>
                            </thead>
                            <tbody id="fin-list-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- SECTION: GRAFIK KURVA -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm border-t-8 border-t-blue-500">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6"><i class="fas fa-chart-area mr-2 text-blue-500"></i> Tren Skor Konsistensi</h3>
                    <div style="height: 250px;"><canvas id="consistencyChart"></canvas></div>
                </div>

                <!-- GLOBAL NOTES -->
                <div class="pb-12">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest"><i class="fas fa-sticky-note mr-2"></i> Brainstorming / Notes</h3>
                    <textarea id="general-notes" oninput="saveGeneralNotes()" placeholder="Tuliskan ide bebas Anda di sini..." class="w-full h-40 bg-white border border-slate-200 p-6 rounded-2xl text-sm shadow-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                </div>

            </div>
        </main>
    </div>

    <script>
        const STORAGE_KEY = 'planner_state_2026_pro_persistent_v1'; // Kunci penyimpanan baru yang aman

        // State Default untuk mencegah error jika data kosong/baru
        const defaultState = { 
            daily: [], 
            targets: [], 
            listTugas: [], 
            financials: [], 
            recurringTasks: [], 
            recurringDone: {}, 
            generalNotes: '',
            lastView: 'dashboard' // Mengingat halaman terakhir dibuka
        };

        let state = { ...defaultState };
        let currentMonth = new Date().getMonth(); 
        const year = 2026;
        let consistencyChart = null;
        let editingRecId = null;
        const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
        const dayNames = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

        function init() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    state = { ...defaultState, ...parsed }; // Merge dengan default agar tidak ada data undefined
                }
            } catch (e) {
                console.error("Gagal memuat data", e);
            }

            document.getElementById('current-date-display').innerText = new Date().toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });
            document.getElementById('general-notes').value = state.generalNotes || '';
            
            // Otomatis buka tab yang terakhir dikunjungi sebelum web ditutup
            setView(state.lastView || 'dashboard');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isHidden = sidebar.classList.contains('-translate-x-full');
            sidebar.classList.toggle('-translate-x-full', !isHidden);
            overlay.classList.toggle('hidden', !isHidden);
        }

        function setView(view) {
            if (view === 'calendar') currentMonth = new Date().getMonth();

            const views = ['dashboard', 'daily', 'target', 'calendar', 'list-tugas', 'financial', 'recurring'];
            views.forEach(v => document.getElementById('view-' + v).classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
            
            const navs = ['dashboard', 'daily', 'target', 'calendar', 'list-tugas', 'financial', 'recurring'];
            navs.forEach(n => {
                const el = document.getElementById('nav-' + n);
                n === view ? el.classList.add('sidebar-item-active') : el.classList.remove('sidebar-item-active');
            });

            document.getElementById('view-title').innerText = view === 'target' ? 'TARGET REALISTIS' : view.replace('-', ' ').toUpperCase();
            if (window.innerWidth < 1024) toggleSidebar();
            
            // Simpan posisi halaman saat ini agar saat direfresh tidak kembali ke dashboard
            state.lastView = view;
            saveAndRefresh();
        }

        function saveAndRefresh() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); 
            updateUI(); 
        }

        function saveGeneralNotes() { 
            state.generalNotes = document.getElementById('general-notes').value; 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); 
        }

        function changeMonth(dir) { 
            currentMonth = (currentMonth + dir + 12) % 12; 
            renderCalendar(); 
        }

        // --- TARGET REALISTIS LOGIC ---
        function addTargetRealistis() {
            const name = document.getElementById('target-input').value;
            const startDateStr = document.getElementById('target-start-date').value;
            const period = document.getElementById('target-period').value;
            const quad = document.getElementById('target-quadrant').value;
            
            if (!name || !startDateStr) return;
            const startDate = new Date(startDateStr);
            let endDate = new Date(startDate);
            if (period === '1w') endDate.setDate(startDate.getDate() + 7);
            if (period === '1m') endDate.setMonth(startDate.getMonth() + 1);
            if (period === '3m') endDate.setMonth(startDate.getMonth() + 3);
            if (period === '6m') endDate.setMonth(startDate.getMonth() + 6);
            
            state.targets.push({ 
                id: Date.now(), 
                name, 
                startDate: startDate.toISOString().split('T')[0], 
                endDate: endDate.toISOString().split('T')[0], 
                period, 
                quad, 
                done: false 
            });
            
            document.getElementById('target-input').value = '';
            document.getElementById('target-start-date').value = '';
            saveAndRefresh();
        }

        function deleteTarget(id) { state.targets = state.targets.filter(t => t.id !== id); saveAndRefresh(); }

        function renderTargets() {
            // Bersihkan semua kuadran
            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById('tgt-q-' + i);
                if (el) el.innerHTML = '';
            }

            state.targets.forEach(t => {
                const labels = { '1w': '1 Minggu', '1m': '1 Bulan', '3m': '3 Bulan', '6m': '6 Bulan' };
                const div = document.createElement('div');
                div.className = "p-3 rounded-xl border-l-4 bg-white shadow-sm flex flex-col justify-between border-slate-200";
                div.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-[11px] uppercase text-slate-800">${t.name}</h4>
                            <span class="text-[8px] font-bold text-blue-500 bg-blue-50 px-1.5 py-0.5 rounded">${labels[t.period]}</span>
                        </div>
                        <p class="text-[9px] font-mono text-slate-500 mt-1.5">${t.startDate} s/d ${t.endDate}</p>
                    </div>
                    <div class="flex justify-end mt-2">
                        <button onclick="deleteTarget(${t.id})" class="text-slate-300 hover:text-red-500 transition focus:outline-none"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `;
                
                // Jika data lama tidak memiliki quad, default ke quad 1
                const targetQuad = t.quad || "1";
                const container = document.getElementById('tgt-q-' + targetQuad);
                if (container) container.appendChild(div);
            });
        }

        // --- RECURRING LOGIC ---
        function saveRecurringTask() {
            const name = document.getElementById('rec-name').value;
            const time = document.getElementById('rec-time').value;
            const quad = document.getElementById('rec-quadrant').value;
            const period = parseInt(document.getElementById('rec-period').value);
            const checkboxes = document.querySelectorAll('input[name="rec-days"]:checked');
            const days = Array.from(checkboxes).map(cb => parseInt(cb.value));
            
            if (!name || days.length === 0) {
                alert("Mohon lengkapi nama tugas dan pilih setidaknya satu hari pelaksanaan!");
                return;
            }
            
            const taskData = { id: editingRecId || Date.now(), name, time, quad, period, days, createdAt: new Date().toISOString() };
            
            if (editingRecId) { 
                state.recurringTasks = state.recurringTasks.map(t => t.id === editingRecId ? taskData : t); 
                editingRecId = null; 
            } else { 
                state.recurringTasks.push(taskData); 
            }
            
            // Reset input
            document.getElementById('rec-name').value = '';
            document.getElementById('rec-time').value = '';
            document.querySelectorAll('input[name="rec-days"]').forEach(cb => cb.checked = false);
            
            saveAndRefresh();
        }

        function isRecurringValid(task, dateKey) {
            const checkDate = new Date(dateKey);
            if (!task.days.includes(checkDate.getDay())) return false;
            if (task.period === 999) return true;
            const start = new Date(task.createdAt);
            const diffMonths = (checkDate.getFullYear() - start.getFullYear()) * 12 + (checkDate.getMonth() - start.getMonth());
            return diffMonths < task.period;
        }

        function editRec(id) {
            const task = state.recurringTasks.find(t => t.id === id);
            if (!task) return;
            editingRecId = id;
            document.getElementById('rec-name').value = task.name;
            document.getElementById('rec-time').value = task.time || '';
            document.getElementById('rec-quadrant').value = task.quad;
            document.getElementById('rec-period').value = task.period;
            document.querySelectorAll('input[name="rec-days"]').forEach(cb => { cb.checked = task.days.includes(parseInt(cb.value)); });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteRec(id) { 
            state.recurringTasks = state.recurringTasks.filter(t => t.id !== id); 
            saveAndRefresh(); 
        }

        function toggleRecDone(dateKey, recId) {
            const key = `${dateKey}-${recId}`;
            state.recurringDone[key] = !state.recurringDone[key];
            saveAndRefresh();
        }

        function renderRecurringList() {
            const body = document.getElementById('rec-list-body');
            if (!body) return;
            body.innerHTML = '';
            state.recurringTasks.forEach(t => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-slate-50";
                tr.innerHTML = `
                    <td class="p-4 font-bold text-slate-700">${t.name} <br><span class="text-[9px] text-slate-400 font-normal">${t.time || '--:--'}</span></td>
                    <td class="p-4 text-slate-500">${t.days.map(d=>dayNames[d].substring(0,3)).join(', ')}</td>
                    <td class="p-4 font-bold text-center">Q${t.quad}</td>
                    <td class="p-4 text-center space-x-2">
                        <button onclick="editRec(${t.id})" class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteRec(${t.id})" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                body.appendChild(tr);
            });
        }

        // --- CORE LOGICS (DAILY) ---
        function addDailyTask() {
            const input = document.getElementById('daily-input');
            const time = document.getElementById('daily-time').value;
            const q = document.getElementById('daily-quadrant').value;
            if (!input.value.trim()) return;
            state.daily.push({ id: Date.now(), text: input.value, time, quadrant: q, done: false, date: new Date().toISOString().split('T')[0] });
            input.value = ''; document.getElementById('daily-time').value = '';
            saveAndRefresh();
        }

        function toggleDaily(id) { 
            const t = state.daily.find(i => i.id === id); 
            if (t) t.done = !t.done; 
            saveAndRefresh(); 
        }

        function deleteDaily(id) {
            state.daily = state.daily.filter(t => t.id !== id);
            saveAndRefresh();
        }

        // --- LIST TUGAS LOGIC ---
        function addListTugas() {
            const input = document.getElementById('tugas-input');
            const date = document.getElementById('tugas-date').value;
            if (!input.value.trim() || !date) return;
            state.listTugas.push({ id: Date.now(), text: input.value, date, done: false });
            input.value = ''; saveAndRefresh();
        }

        function toggleListTugas(id) {
            const t = state.listTugas.find(i => i.id === id);
            if (t) t.done = !t.done;
            saveAndRefresh();
        }

        function deleteListTugas(id) {
            state.listTugas = state.listTugas.filter(t => t.id !== id);
            saveAndRefresh();
        }

        // --- FINANCIAL LOGIC ---
        function addFinancialTransaction() {
            const title = document.getElementById('fin-title').value;
            const amount = parseFloat(document.getElementById('fin-amount').value);
            const cat = document.getElementById('fin-category').value;
            const type = document.getElementById('fin-type').value;
            if (!title || isNaN(amount)) return;
            state.financials.push({ id: Date.now(), title, amount, category: cat, type, date: new Date().toISOString().split('T')[0] });
            document.getElementById('fin-title').value = ''; document.getElementById('fin-amount').value = '';
            saveAndRefresh();
        }
        
        function deleteFinancial(id) {
            state.financials = state.financials.filter(t => t.id !== id);
            saveAndRefresh();
        }

        function getDayStatus(dateKey) {
            const manualTasks = state.daily.filter(t => t.date === dateKey);
            const recTasks = state.recurringTasks.filter(t => isRecurringValid(t, dateKey));
            const total = manualTasks.length + recTasks.length;
            if (total === 0) return 'none';
            return (total >= 5 && manualTasks.every(t => t.done) && recTasks.every(t => state.recurringDone[`${dateKey}-${t.id}`])) ? 'success' : 'fail';
        }

        // --- MAIN RENDERING ---
        function updateUI() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dash-daily').innerText = state.daily.filter(t => t.date === today).length + state.recurringTasks.filter(t => isRecurringValid(t, today)).length;
            document.getElementById('dash-target').innerText = state.targets.length;
            document.getElementById('dash-recurring').innerText = state.recurringTasks.length;
            
            renderDaily(); 
            renderTargets(); 
            renderRecurringList();
            renderListTugas();
            renderCalendar(); 
            renderFinancials();
            renderCharts();

            const total = state.daily.length + state.targets.length + state.listTugas.length + state.recurringTasks.length;
            const done = state.daily.filter(t=>t.done).length + state.listTugas.filter(t=>t.done).length + Object.values(state.recurringDone).filter(v=>v).length;
            const p = total ? Math.round((done/total)*100) : 0;
            document.getElementById('overall-progress').style.width = p + '%';
            document.getElementById('progress-text').innerText = p + '%';
        }

        function renderDaily() {
            const today = new Date().toISOString().split('T')[0];
            for (let i = 1; i <= 4; i++) {
                const container = document.getElementById('q-' + i);
                if(!container) continue;
                container.innerHTML = '';
                
                // Tugas Manual
                state.daily.filter(t => t.date === today && t.quadrant == i).forEach(t => {
                    const div = document.createElement('div');
                    div.className = `flex items-center justify-between p-2.5 bg-white rounded-lg border shadow-sm text-[10px] ${t.done ? 'opacity-50' : ''}`;
                    div.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <button onclick="toggleDaily(${t.id})" class="focus:outline-none"><i class="${t.done ? 'fas fa-check-square text-blue-500' : 'far fa-square text-slate-300'} text-sm hover:text-blue-400"></i></button>
                            <div>
                                <span class="${t.done ? 'line-through text-slate-400' : 'font-bold text-slate-700'}">${t.text}</span>
                                <p class="text-[8px] text-blue-500 font-bold">${t.time || 'Waktu Bebas'}</p>
                            </div>
                        </div>
                        <button onclick="deleteDaily(${t.id})" class="text-slate-300 hover:text-red-500 focus:outline-none"><i class="fas fa-trash-alt"></i></button>
                    `;
                    container.appendChild(div);
                });

                // Tugas Tetap (Recurring)
                state.recurringTasks.filter(t => isRecurringValid(t, today) && t.quad == i).forEach(t => {
                    const isDone = state.recurringDone[`${today}-${t.id}`];
                    const div = document.createElement('div');
                    div.className = `flex items-center justify-between p-2.5 bg-purple-50 rounded-lg border border-purple-100 text-[10px] ${isDone ? 'opacity-50' : ''}`;
                    div.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <button onclick="toggleRecDone('${today}', ${t.id})" class="focus:outline-none"><i class="${isDone ? 'fas fa-check-square text-purple-600' : 'far fa-square text-purple-300'} text-sm hover:text-purple-400"></i></button>
                            <div>
                                <span class="${isDone ? 'line-through text-purple-400' : 'font-bold text-purple-900'}">${t.name}</span>
                                <p class="text-[8px] text-purple-500 font-bold">${t.time || 'Rutinitas'}</p>
                            </div>
                        </div>
                        <i class="fas fa-redo text-purple-300 text-xs"></i>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function renderListTugas() {
            const raw = document.getElementById('tugas-list-raw');
            if(!raw) return;
            raw.innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById('t-q-' + i);
                if(el) el.innerHTML = '';
            }
            
            state.listTugas.forEach(t => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-2.5 bg-white border rounded-lg shadow-sm text-xs";
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <button onclick="toggleListTugas(${t.id})" class="focus:outline-none"><i class="${t.done ? 'fas fa-check-circle text-green-500' : 'far fa-circle text-slate-300'} hover:text-green-400"></i></button>
                        <span class="${t.done ? 'line-through text-slate-400' : 'font-bold text-slate-700'}">${t.text}</span>
                        <span class="text-[9px] bg-slate-100 px-2 py-0.5 rounded text-slate-500">${t.date}</span>
                    </div>
                    <button onclick="deleteListTugas(${t.id})" class="text-slate-300 hover:text-red-500 focus:outline-none"><i class="fas fa-trash-alt"></i></button>
                `;
                raw.appendChild(div);
                
                if (!t.done) {
                    const diff = Math.ceil((new Date(t.date) - new Date().setHours(0,0,0,0)) / 86400000);
                    const p = diff <= 2 ? 1 : (diff <= 7 ? 2 : (diff <= 14 ? 3 : 4));
                    const m = document.createElement('div');
                    m.className = "p-2 bg-white rounded shadow-sm border-l-4 text-[9px] font-bold flex justify-between";
                    m.style.borderLeftColor = p === 1 ? '#ef4444' : (p === 2 ? '#f59e0b' : '#3b82f6');
                    m.innerHTML = `<span>${t.text}</span> <span class="text-slate-400">${t.date}</span>`;
                    const matrixContainer = document.getElementById('t-q-' + p);
                    if(matrixContainer) matrixContainer.appendChild(m);
                }
            });
        }

        function renderFinancials() {
            const body = document.getElementById('fin-list-body');
            if(!body) return;
            let inc = 0, exp = 0;
            body.innerHTML = '';
            [...state.financials].reverse().forEach(f => {
                f.type === 'income' ? inc += f.amount : exp += f.amount;
                const tr = document.createElement('tr');
                tr.className = "border-b text-[10px]";
                tr.innerHTML = `
                    <td class="p-4 font-mono text-slate-400">${f.date}</td>
                    <td class="p-4 font-bold">${f.title} <br><span class="text-[8px] uppercase bg-slate-100 px-1 rounded">${f.category}</span></td>
                    <td class="p-4 text-right font-black ${f.type === 'income' ? 'text-emerald-600' : 'text-red-500'}">Rp ${f.amount.toLocaleString('id-ID')}</td>
                    <td class="p-4 text-center"><button onclick="deleteFinancial(${f.id})" class="text-slate-300 hover:text-red-500"><i class="fas fa-trash-alt"></i></button></td>
                `;
                body.appendChild(tr);
            });
            document.getElementById('fin-income').innerText = "Rp " + inc.toLocaleString('id-ID');
            document.getElementById('fin-expense').innerText = "Rp " + exp.toLocaleString('id-ID');
            document.getElementById('fin-balance').innerText = "Rp " + (inc-exp).toLocaleString('id-ID');
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid'); 
            if(!grid) return;
            grid.innerHTML = '';
            document.getElementById('cal-month').innerText = `${monthNames[currentMonth]} ${year}`;
            const now = new Date();
            const todayDate = now.getDate();
            const todayMonth = now.getMonth();
            const todayYear = now.getFullYear();
            const first = new Date(year, currentMonth, 1).getDay();
            const days = new Date(year, currentMonth + 1, 0).getDate();
            for (let i = 0; i < first; i++) grid.appendChild(document.createElement('div')).className = "bg-slate-50/50 rounded-lg";
            for (let d = 1; d <= days; d++) {
                const dateKey = `${year}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const status = getDayStatus(dateKey);
                const dayOfWeek = new Date(year, currentMonth, d).getDay();
                
                const isHoliday = (dayOfWeek === 0 || dayOfWeek === 6); 
                const isToday = (todayYear === year && todayMonth === currentMonth && todayDate === d);
                
                const cell = document.createElement('div');
                cell.className = `calendar-day ${isToday ? 'today-highlight' : ''}`;
                cell.innerHTML = `<span class="text-[9px] sm:text-xs font-black ${isToday ? 'text-blue-600' : (isHoliday ? 'text-red-600 font-bold' : 'text-slate-800')}">${d}</span>`;
                
                if (status === 'success') cell.classList.add('day-success');
                if (status === 'fail') cell.classList.add('day-fail');

                state.targets.forEach(t => { if (dateKey >= t.startDate && dateKey <= t.endDate) { cell.innerHTML += `<div class="target-pill target-pill-${t.period}">${t.name}</div>`; } });
                state.listTugas.filter(t => t.date === dateKey).forEach(t => { cell.innerHTML += `<div class="task-pill">${t.text}</div>`; });
                state.recurringTasks.filter(t => isRecurringValid(t, dateKey)).forEach(t => { cell.innerHTML += `<div class="recurring-pill">${t.name}</div>`; });
                grid.appendChild(cell);
            }
        }

        function renderCharts() {
            if (consistencyChart) consistencyChart.destroy();
            const cCtx = document.getElementById('consistencyChart');
            if(!cCtx) return;
            let labels = [], points = [], score = 0;
            for(let i=14; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate()-i); const key = d.toISOString().split('T')[0];
                const s = getDayStatus(key); s==='success' ? score++ : (s==='fail' ? score=Math.max(0,score-1) : null);
                labels.push(d.getDate()+'/'+(d.getMonth()+1)); points.push(score);
            }
            consistencyChart = new Chart(cCtx, { type:'line', data:{ labels, datasets:[{label:'Skor',data:points,borderColor:'#3b82f6',tension:0.3,fill:false}]}, options:{maintainAspectRatio:false, plugins:{legend:{display:false}}}});
        }

        init();
        setView(state.lastView || 'dashboard');
    </script>
</body>
</html>